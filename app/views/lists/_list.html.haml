.outer__cardList
  - lists.each_with_index do |list, i|
    .l__cardList
      -if is_signin && is_signed(current_user.id, list.user.id)
        //自分のプレイリスト
        = link_to edit_list_path(list) do
          .cardList__img
            = render 'lists/is_image', list: list
          .cardList__text
            %span.listtitle= trun_str(list.title, 18)
            %span.author= trun_str(list.user.name, 20)
            %span.favoriteStar
              %i.material-icons star_rate
              = list.list_favorites.count
            %p= trun_str(list.description, 40)
            .cardList__footer
              - list.tag_list.each.with_index(0) do |listgenre, i|
                %span.genretag
                  = listgenre
                // - if i > 4
                //   %span.genretag　...
                //   - break
                // - else
                //   %span.genretag
                //     = listgenre
                
            %span.listprice ¥#{list.price}
      -else
        - if is_purchase?(current_user, list) 
          //購入済みリスト
          .cardList__img
            = render 'lists/is_image', list: list
          .cardList__text
            %span.listtitle= link_to trun_str(list.title, 18), list_path(list) , class: "testclass"
            %span.author= link_to trun_str(list.user.name, 20), users_playlist_path(list.user)
            //プレイリストお気に入り機能
            = render 'lists/fav_form', list: list if user_signed_in?
            // %span.favoriteStar
            //   %i.material-icons star_rate
            //   = list.list_favorites.count
            %span.label.label-warning 購入済み
            
            %p= trun_str(list.description, 40)
            .tags
              - list.tag_list.each.with_index(0) do |listgenre, i|
                %span.genretag
                  = link_to listgenre, chart_path(genre: listgenre, sort: Constants::SORT)
            %span.listprice ¥#{list.price}
        
        - else
          //まだ購入していないプレイリスト
          %a.modal-syncer{"data-target" => "modal-content-#{i}"} 
            .cardList__img
              = render 'lists/is_image', list: list
            .cardList__text
              %span.listtitle= trun_str(list.title, 18)
              %span.author= trun_str(list.user.name, 20)
              %span.favoriteStar
                %i.material-icons star_rate
                = list.list_favorites.count
              %p= trun_str(list.description, 40)
              .tags
                - list.tag_list.each.with_index(0) do |listgenre, i|
                  %span.genretag
                    = listgenre
              %span.listprice ¥#{list.price}

    // ここからモーダルウィンドウ
    .modal-content{:id => "modal-content-#{i}"}
      // モーダルウィンドウのコンテンツ開始
      // Stripe決済部分
      //ログインユーザーのプレイリストじゃなかったら
      
      .cardList__img
        = render 'lists/is_image', list: list
      .cardList__text
        %span.listtitle= trun_str(list.title, 18)
        %span.author= link_to trun_str(list.user.name, 20), users_playlist_path(list.user)
        %p= list.description
        .tags
          - list.tag_list.each.with_index(0) do |listgenre, i|
            %span.genretag
              = link_to listgenre, chart_path(genre: listgenre, sort: Constants::SORT)
        // モーダルウィンドウのコンテンツ終了
        %span.listprice ¥#{list.price}
        = render "charges/stripe_checkout", customer: customer, list: list, cont_no: i
        %p
          %a#modal-close.button-link 閉じる

